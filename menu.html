<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Menu - Bake & Grill</title>
  <meta name="description" content="Browse our delicious menu of pizzas, burgers, sandwiches, and quick bites.">
  
  <!-- CSS -->
  <link rel="stylesheet" href="/css/fontawesome.min.css">
  <link rel="stylesheet" href="/css/styles.css">
  
  <!-- Preload critical resources -->
  <link rel="preload" href="/js/main.js" as="script">
  <link rel="preload" href="/css/styles.css" as="style">
</head>
<body class="mobile-view">
  <header class="mobile-header">
    <div class="logo-container">
      <a href="index.html" class="back-button" aria-label="Go back"><i class="fas fa-arrow-left"></i></a>
      <div class="logo">Our Menu</div>
      <div class="mobile-cart-icon" id="mobileCartBtn" aria-label="Cart" role="button">
        <i class="fas fa-shopping-cart"></i>
        <span class="cart-badge" aria-live="polite">0</span>
      </div>
    </div>
  </header>

  <div id="statusBanner" class="status-banner">
    <div id="shopStatusBanner" class="status-item">
      <i class="fas fa-store" aria-hidden="true"></i> <span id="shopStatusText">Shop: Open (4PM-10PM)</span>
    </div>
    <div id="deliveryStatusBanner" class="status-item">
      <i class="fas fa-truck" aria-hidden="true"></i> <span id="deliveryStatusText">Delivery: Available (8km radius)</span>
    </div>
  </div>

  <div class="mobile-container">
    <div id="mobileSearchContainer">
      <i class="fas fa-search" aria-hidden="true"></i>
      <input type="text" id="searchInput" placeholder="Search menu items..." class="mobile-search" aria-label="Search menu">
    </div>
    
    <div id="tabs" class="mobile-category-nav" role="tablist"></div>
    
    <div id="menuContainer" class="mobile-menu-container"></div>
  </div>

  <!-- Cart Drawer -->
  <div id="mobileCartDrawer" class="mobile-cart-drawer" aria-modal="true">
    <div class="drawer-header">
      <h3>Your Order <span class="cart-count">(<span id="cartItemCount">0</span>)</span></h3>
      <button class="close-drawer" id="closeCartBtn" aria-label="Close cart">&times;</button>
    </div>
    <div class="drawer-content">
      <ul id="cartItems" class="mobile-cart-items" role="list">
        <!-- Cart items will be inserted here dynamically -->
      </ul>
      <div class="mobile-total-display">
        <span class="total-items"><span id="totalItemCount">0</span> items</span>
        <span class="total-amount">₹<span id="cartTotalAmount">0</span></span>
      </div>
    </div>
    <div class="drawer-footer">
      <button id="mobileClearCartBtn" class="mobile-clear-btn"><i class="fas fa-trash" aria-hidden="true"></i> Clear</button>
      <a href="checkout.html" id="mobileCheckoutBtn" class="mobile-checkout-btn"><i class="fas fa-shopping-bag" aria-hidden="true"></i> Checkout</a>
    </div>
  </div>

  <!-- Cart Overlay -->
  <div id="cartOverlay" class="cart-overlay"></div>

  <!-- Quantity Footer -->
  <div id="quantityFooter" class="quantity-footer">
    <div class="quantity-footer-content">
      <div class="quantity-footer-header">
        <h4 id="quantityItemName" class="truncate">Item Name</h4>
        <p id="quantityVariantPrice">Variant - ₹0</p>
      </div>
      <div class="quantity-controls-container">
        <div class="quantity-controls">
          <button class="quantity-btn minus" aria-label="Decrease quantity">−</button>
          <span class="quantity" aria-live="polite">1</span>
          <button class="quantity-btn plus" aria-label="Increase quantity">+</button>
        </div>
      </div>
      <div class="quantity-footer-actions">
        <button class="cancel-btn">Cancel</button>
        <button class="add-to-cart-btn">Add to Cart</button>
      </div>
    </div>
  </div>

  <footer class="mobile-footer">
    <div class="footer-content">
      <div class="footer-nav">
        <a href="index.html">Home</a>
        <a href="menu.html">Menu</a>
        <a href="checkout.html">Checkout</a>
      </div>
      <p>&copy; 2025 Bake & Grill. All rights reserved.</p>
    </div>
  </footer>

  <div class="mobile-notification" id="notification">
    <i class="fas fa-check-circle" aria-hidden="true"></i>
    <span id="notificationText">Item added to cart!</span>
  </div>

  <!-- Screen reader notifications -->
  <div id="a11y-notification" aria-live="polite" class="sr-only"></div>

  <!-- JS -->
  <script src="/js/idb.js"></script>
  <script type="module" src="/js/main.js"></script>
  <script type="module" src="/js/menu.js"></script>

  <script>
    // Service Worker Registration
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', async () => {
        try {
          const registration = await navigator.serviceWorker.register('/sw.js');
          console.log('ServiceWorker registered:', registration.scope);
          await registration.sync.register('submit-order');
        } catch (err) {
          console.error('ServiceWorker registration failed:', err);
        }
      });
    }

    // Offline detection
    const updateOnlineStatus = () => {
      const indicator = document.querySelector('.offline-indicator');
      if (indicator) {
        indicator.style.display = navigator.onLine ? 'none' : 'block';
      }
    };
    window.addEventListener('online', updateOnlineStatus);
    window.addEventListener('offline', updateOnlineStatus);
    updateOnlineStatus();

    // Error logging
    window.addEventListener('error', (e) => {
      const errorData = {
        error: e.message,
        stack: e.error?.stack,
        url: window.location.href,
        timestamp: new Date().toISOString()
      };
      
      if (navigator.onLine) {
        fetch('/api/log-error', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(errorData)
        }).catch(console.error);
      } else {
        const errors = JSON.parse(localStorage.getItem('pendingErrors') || '[]');
        errors.push(errorData);
        localStorage.setItem('pendingErrors', JSON.stringify(errors));
      }
    });
  </script>
</body>
</html>